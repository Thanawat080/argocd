@using System.ComponentModel
@using System.Net.Http.Headers
@inject HttpClient Http

@inject ModalService _modalService
<style>
    .ant-card-head {
        width: 100%;
        background: #ffcc41 !important;
        border-radius: 6px 6px 0px 0px !important;
    }

    .ant-card-head {
        min-height: 48px;
        margin-bottom: -1px;
        padding: 0 24px;
        color: rgba(0, 0, 0, 0.85);
        font-weight: 500;
        font-size: 16px;
        background: transparent;
        border-bottom: 1px solid #ffffff;
        border-radius: 2px 2px 0 0;
    }

    .ant-card {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        color: rgba(0, 0, 0, 0.85);
        font-size: 18px !important;
        text-align: center !important;
        font-variant: tabular-nums;
        line-height: 1.5715;
        list-style: none;
        font-feature-settings: 'tnum';
        position: relative;
        background: #fff;
        border-radius: 6px !important;
        box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    }

    .ant-card-head-title {
        display: inline-block;
        flex: 1;
        padding: 16px 0;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        font-size: 20px !important;
        text-align: center;
        color: #334396;
    }

    .ant-table-thead > tr > th, .ant-table-tbody > tr > td, .ant-table tfoot > tr > th, .ant-table tfoot > tr > td {
        position: relative;
        padding: 16px 4px 16px 4px;
        overflow-wrap: break-word;
        width: 100%;
    }
</style>

<div class="site-layout-background" style="padding: 24px;">
    <div class="mms-nav-title">
        <div class="mms-text-title px-4 py-3">ประสบอันตรายหรือเจ็บป่วยฉุกเฉิน 72 ชั่วโมง</div>
    </div>
    <div class="p-md-2 p-lg-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item" aria-current="page">
                    <span class="breadcum-title py-2">ค้นหารายการตามงวด</span>
                </li>
                <li class="breadcrumb-item" aria-current="page">
                    <span class="breadcum-sucress py-2" @onclick="()=> GetIndexPage(1)">แสดงรายการงวดที่เลือก</span>
                </li>
                <li class="breadcrumb-item" aria-current="page">
                    <span class="breadcum-process py-2">รายละเอียดการประมวลผล</span>
                </li>
            </ol>
        </nav>
        <hr />
        <div class="container p-2">
            <div class="row">
                <div class="col-sm-12 col-md-2"></div>
                <div class="col-sm-12 col-md-8">
                    <div class="row">
                        <div class="col-md-6 col-lg-4 py-2">
                            <Card Bordered="false" Title=@("ประมวลผลทั้งหมด")>
                                <Body>
                                    <span>25</span>
                                </Body>
                            </Card>
                        </div>
                        <div class="col-md-6 col-lg-4 py-2">
                            <Card Bordered="false" Title=@("ผ่านการประมวลผล")>
                                <Body>
                                    <span>24</span>
                                </Body>
                            </Card>
                        </div>
                        <div class="col-md-6 col-lg-4 py-2">
                            <Card Bordered="false" Title=@("ไม่ผ่านการประมวลผล")>
                                <Body>
                                    <span>1</span>
                                </Body>
                            </Card>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 col-md-2"></div>
            </div>
        </div>
        <div class="mms-media-center p-4">
            <Button Type="@ButtonType.Primary" OnClick="@(()=> OpenDetailPassword(true))">
                <i class="fa-solid fa-pen-to-square"></i>&nbsp; ส่งไปทำใบคำสั่งจ่าย
            </Button>
        </div>
        <div class="row">
            <div class="col-sm-12 col-lg-8 mms-media-start align-items-end">
                <div class="mms-txt-headdetail">รายการเบิกที่ผ่านการประมวลผล</div>
            </div>
            <div class="col-sm-12 col-lg-4 mms-media-end">
                <Space Direction="@DirectionVHType.Vertical" Class="mms-btn-serch w-100">
                    <SpaceItem>
                        <Search Placeholder="ข้อมูลที่ต้องการค้นหา..." EnterButton="true" />
                    </SpaceItem>
                </Space>
            </div>
        </div>
        <hr />

        <Table DefaultExpandAllRows DataSource="_data" TreeChildren="item=>item.Children" Bordered HidePagination="false" ScrollX="1300">
            <ColumnDefinitions>
                @if (context.HosName == null)
                {
                    <PropertyColumn Width="90px" Title="ลำดับ" Property="c=>c.Id" ColSpan="@GetColSpan(context.HosStauts , "name")" Style="@GetColColor(context.HosStauts , "name")" />
                }
                else
                {
                    <PropertyColumn Width="90px" Title="ลำดับ" Property="c=>c.HosName" ColSpan="@GetColSpan(context.HosStauts , "name")" Style="@GetColColor(context.HosStauts , "name")" />
                }
                <PropertyColumn Align="@ColumnAlign.Center" Title="เลขประจำตัวประชาชน" Property="c=>c.PersonId" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                <PropertyColumn Align="@ColumnAlign.Center" Title="ชื่อ-นามสกุล" Property="c=>c.Name" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                <PropertyColumn Align="@ColumnAlign.Center" Title="Admit Date" Property="c=>c.Name" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                <PropertyColumn Align="@ColumnAlign.Center" Title="Discharge Date" Property="c=>c.Name" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                <PropertyColumn Align="@ColumnAlign.Center" Title="จำนวนชั่วโมงรวม (ตามรักษาจริง)" Width="150px" Property="c=>c.HoursRight" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                    <div>@context.HoursRight<span class="ps-2">ชั่วโมง</span></div>
                </PropertyColumn>
                <PropertyColumn Align="@ColumnAlign.Center" Title="วันที่ส่งเบิก" Property="c=>c.DisbursementDate" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                <PropertyColumn Align="@ColumnAlign.Center" Title="จำนวนชั่วโมงรวม (ตามสิทธิ)" Width="150px" Property="c=>c.HoursAmount" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                    <div>@context.HoursAmount<span class="ps-2">ชั่วโมง</span></div>
                </PropertyColumn>
                <PropertyColumn Align="@ColumnAlign.Center" Title="จำนานเงินที่เบิก (บาท)" Property="c=>c.AmountWithdrawn" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                    @String.Format("{0:n}",context.AmountWithdrawn)
                </PropertyColumn>
                <PropertyColumn Align="@ColumnAlign.Center" Title="จำนานเงินที่จ่าย (บาท)" Property="c=>c.AmountPaid" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                    @String.Format("{0:n}",context.AmountPaid)
                </PropertyColumn>
                <PropertyColumn Align="@ColumnAlign.Center" Title="สถานะ" Property="c=>c.Stauts" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" Width="5%">
                    @if (context.Stauts == true)
                    {
                        <span style="color:green"><span class="status-color-green me-2"></span>อนุมัติ</span>
                    }
                    else
                    {
                        <span style="color:orangered"><span class="status-color-orangered me-2"></span>รอดำเนินการ</span>
                    }
                </PropertyColumn>
                <PropertyColumn Width="100px" Align="@ColumnAlign.Center" Title="" Property="c=>c.Id" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                    <img class="mx-2" title="แก้ไข" src="helper_shared/PortalAdminImage/eye.png" style="width:24px;height:24px; cursor:pointer;" @onclick="@(()=> OpenComplicationsModal(true))" />
                </PropertyColumn>
            </ColumnDefinitions>
            @*             <PaginationTemplate>
            <Pagination Class="pt-2"
            Total="context.Total"
            PageSize="context.PageSize"
            Current="context.PageIndex"
            ShowSizeChanger
            OnChange="context.HandlePageChange" />
            </PaginationTemplate> *@
        </Table>
        <div class="my-5">
            <div class="row">
                <div class="col-sm-12 col-lg-8 mms-media-start align-items-end">
                    <div class="mms-txt-headdetail">รายการเบิกที่ไม่ผ่านการประมวลผล</div>
                </div>
                <div class="col-sm-12 col-lg-4 mms-media-end">
                    <Space Direction="@DirectionVHType.Vertical" Class="mms-btn-serch w-100">
                        <SpaceItem>
                            <Search Placeholder="ข้อมูลที่ต้องการค้นหา..." EnterButton="true" />
                        </SpaceItem>
                    </Space>
                </div>
            </div>
            <hr />
            <Table DefaultExpandAllRows DataSource="_data" TreeChildren="item=>item.Children" Bordered HidePagination="false" ScrollX="1300" PageSize="@pageindex">
                <ColumnDefinitions>
                    @if (context.HosName == null)
                    {
                        <PropertyColumn Width="90px" Title="ลำดับ" Property="c=>c.Id" ColSpan="@GetColSpan(context.HosStauts , "name")" Style="@GetColColor(context.HosStauts , "name")" />
                    }
                    else
                    {
                        <PropertyColumn Width="90px" Title="ลำดับ" Property="c=>c.HosName" ColSpan="@GetColSpan(context.HosStauts , "name")" Style="@GetColColor(context.HosStauts , "name")" />
                    }
                    <PropertyColumn Align="@ColumnAlign.Center" Title="เลขประจำตัวประชาชน" Property="c=>c.PersonId" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                    <PropertyColumn Align="@ColumnAlign.Center" Title="ชื่อ-นามสกุล" Property="c=>c.Name" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                    <PropertyColumn Align="@ColumnAlign.Center" Title="Admit Date" Property="c=>c.Name" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                    <PropertyColumn Align="@ColumnAlign.Center" Title="Discharge Date" Property="c=>c.Name" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                    <PropertyColumn Align="@ColumnAlign.Center" Title="จำนวนชั่วโมงรวม (ตามรักษาจริง)" Width="150px" Property="c=>c.HoursRight" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                        <div>@context.HoursRight<span class="ps-2">ชั่วโมง</span></div>
                    </PropertyColumn>
                    <PropertyColumn Align="@ColumnAlign.Center" Title="วันที่ส่งเบิก" Property="c=>c.DisbursementDate" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" />
                    <PropertyColumn Align="@ColumnAlign.Center" Title="จำนวนชั่วโมงรวม (ตามสิทธิ)" Width="150px" Property="c=>c.HoursAmount" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                        <div>@context.HoursAmount<span class="ps-2">ชั่วโมง</span></div>
                    </PropertyColumn>
                    <PropertyColumn Align="@ColumnAlign.Center" Title="จำนานเงินที่เบิก (บาท)" Property="c=>c.AmountWithdrawn" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                        @String.Format("{0:n}",context.AmountWithdrawn)
                    </PropertyColumn>
                    <PropertyColumn Align="@ColumnAlign.Center" Title="จำนานเงินที่จ่าย (บาท)" Property="c=>c.AmountPaid" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                        @String.Format("{0:n}",context.AmountPaid)
                    </PropertyColumn>
                    <PropertyColumn Align="@ColumnAlign.Center" Title="สถานะ" Property="c=>c.Stauts" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)" Width="5%">
                        @if (context.Stauts == true)
                        {
                            <span style="color:green"><span class="status-color-green me-2"></span>อนุมัติ</span>
                        }
                        else
                        {
                            <span style="color:orangered"><span class="status-color-orangered me-2"></span>รอดำเนินการ</span>
                        }
                    </PropertyColumn>
                    <PropertyColumn Width="100px" Align="@ColumnAlign.Center" Title="" Property="c=>c.Id" ColSpan="@GetColSpan(context.HosStauts)" Style="@GetColColor(context.HosStauts)">
                        <img class="me-2" title="เรียกดู" src="helper_shared/PortalAdminImage/eye.png" style="width:24px;height:24px; cursor:pointer;" />
                        <img title="แจ้งเตือนข้อผิดพลาด" src="helper_shared/PortalAdminImage/alert.png" style="width:24px;height:24px; cursor:pointer;" @onclick="@(()=> OpenDetailAlert(true))" />
                    </PropertyColumn>
                </ColumnDefinitions>
            </Table>
        </div>
    </div>
</div>

@using sso.mms.fees.admin.Shared._72Hours.NotificationList.Modals
<_72H_ModelDetail _visible=@openDetailRightUser OnClose="@OpenComplicationsModal" />
<_72H_Alert _visible=@openDetailAlert OnClose="@OpenDetailAlert" />
<_72H_Confirm _visible=@openDetailPassword OnClose="@OpenDetailPassword" />

@code {
    /*-- CallbackModel --*/
    bool openDetailRightUser { get; set; }
    bool openDetailAlert { get; set; }
    bool openDetailPassword { get; set; }
    int pageindex = 1;
    public void OpenComplicationsModal(bool value)
    {
        openDetailRightUser = value;
    }
    public void OpenDetailAlert(bool value)
    {
        openDetailAlert = value;
    }
    public void OpenDetailPassword(bool value)
    {
        openDetailPassword = value;
    }

    [Parameter]
    public EventCallback<int> IndexPage { get; set; }

    public async Task GetIndexPage(int item)
    {
        await IndexPage.InvokeAsync(item);
    }

    string txtValue { get; set; }

    /*-- Table --*/
    Data[] _data;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        await Task.Delay(500);

        _data = data;
        await InvokeAsync(StateHasChanged);

        await Task.Delay(500);
    }

    Data[] data =
    {
        new() {
            HosStauts  = true,
            HosName = "โรงพยาบาลลานนา1",
            Children = new Data[] {
                new() {
                    Id = "1",
                    PersonId = "123456789XXXX",
                    Key = "11",
                    Name = "Jim Green",
                    HoursRight = 42,
                    HoursAmount = 72,
                    AmountWithdrawn = 30000,
                    AmountPaid = 35000,
                    Address = "London No. 1 Lake Park",
                    Stauts  = false,
                    DisbursementDate  = DateTime.Now
                },
    },
        },
        new() {
            HosStauts  = true,
            HosName = "โรงพยาบาลดำรงค์1",
            Children = new Data[] {
                new() {
                    Id = "1",
                    PersonId = "123456789XXXX",
                    Key = "11",
                    Name = "Jim Green",
                    HoursRight = 42,
                    HoursAmount = 72,
                    AmountWithdrawn = 30000,
                    AmountPaid = 35000,
                    Address = "London No. 1 Lake Park",
                    Stauts  = false,
                    DisbursementDate  = DateTime.Now
                },
                  new() {
                    Id = "1",
                    PersonId = "123456789XXXX",
                    Key = "112",
                    Name = "Jim Green2",
                    HoursRight = 32,
                    HoursAmount = 72,
                    AmountWithdrawn = 30000,
                    AmountPaid = 35000,
                    Address = "London No. 1 Lake Park",
                    Stauts  = false,
                    DisbursementDate  = DateTime.Now
                },
    },
        },
         new() {
            HosStauts  = true,
            HosName = "โรงพยาบาลดำรงค์ 2",
            Children = new Data[] {
                new() {
                    Id = "1",
                    PersonId = "123456789XXXX",
                    Key = "11",
                    Name = "Jim Green",
                    HoursRight = 42,
                    HoursAmount = 72,
                    AmountWithdrawn = 30000,
                    AmountPaid = 35000,
                    Address = "London No. 1 Lake Park",
                    Stauts  = true,
                    DisbursementDate  = DateTime.Now
                },
    },
        },
        new() {
            HosStauts  = true,
            HosName = "โรงพยาบาลราม1",
            Children = new Data[] {
                new() {
                    Id = "1",
                    PersonId = "123456789XXXX",
                    Key = "11",
                    Name = "Jim Green",
                    HoursRight = 42,
                    HoursAmount = 72,
                    AmountWithdrawn = 30000,
                    AmountPaid = 35000,
                    Address = "London No. 1 Lake Park",
                    Stauts  = true,
                    DisbursementDate  = DateTime.Now
                },

    },
        },
         new() {
            HosStauts  = true,
            HosName = "โรงพยาบาลราม2",
            Children = new Data[] {
                new() {
                    Id = "1",
                    PersonId = "123456789XXXX",
                    Key = "11",
                    Name = "Jim Green",
                    HoursRight = 42,
                    HoursAmount = 72,
                    AmountWithdrawn = 30000,
                    AmountPaid = 35000,
                    Address = "London No. 1 Lake Park",
                    Stauts  = true,
                    DisbursementDate  = DateTime.Now
                },
    },
        },
        new() {
            HosStauts  = true,
            HosName = "โรงพยาบาลราม3",
            Children = new Data[] {
                new() {
                    Id = "1",
                    PersonId = "123456789XXXX",
                    Key = "11",
                    Name = "Jim Green",
                    HoursRight = 42,
                    HoursAmount = 72,
                    AmountWithdrawn = 30000,
                    AmountPaid = 35000,
                    Address = "London No. 1 Lake Park",
                    Stauts  = true,
                    DisbursementDate  = DateTime.Now,
                },

    },
        },
    };

    private int GetColSpan(bool HosStauts, string columnTitle = "")
    {
        if (HosStauts == true)
            if (columnTitle == "name")
                return 12;
            else
                return 0;
        else
            return 1;
    }
    private string GetColColor(bool HosStauts, string columnTitle = "")
    {
        if (HosStauts == true)
            if (columnTitle == "name")
                return "background-color:#D8D6D6;";
            else
                return "";
        else
            return "";
    }

    public class Data
    {
        public bool HosStauts { get; set; }

        public bool Stauts { get; set; }

        public string? HosName { get; set; }

        public string? Id { get; set; }

        public string? Key { get; set; }

        public string? Name { get; set; }

        public string? PersonId { get; set; }

        public int? HoursRight { get; set; }

        public int? HoursAmount { get; set; }

        public string? Address { get; set; }

        public int? AmountWithdrawn { get; set; }

        public int? AmountPaid { get; set; }

        public DateTime DisbursementDate { get; set; }

        public Data[] Children { get; set; }
    }


}

