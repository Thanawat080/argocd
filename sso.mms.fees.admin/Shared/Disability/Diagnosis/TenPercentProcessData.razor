@using System.ComponentModel;
@using sso.mms.fees.admin.Shared.Disability.Diagnosis.Modals.NinetyPercentProcess

<style>
    .text-label {
        color: var(--h, #334396);
        font-feature-settings: 'clig' off, 'liga' off;
        font-family: Noto Sans Thai;
        font-size: 19px;
        font-style: normal;
        font-weight: 600;
        line-height: 150%; /* 28.5px */
    }

    .text-header {
        color: var(--h, #334396);
        text-align: start;
        font-family: Noto Sans Thai;
        font-size: 20px;
        font-style: normal;
        font-weight: 700;
        line-height: 20px; /* 100% */
        letter-spacing: 0.2px;
    }
</style>

<div class="site-layout-background" style="padding: 24px;">
    <div class="mms-nav-title">
        <div class="mms-text-title px-4 py-3">ค่าบริการทางการแพทย์กรณีทุพพลภาพ >> งานวินิจฉัย >> รายละเอียดการประมวลผล</div>
    </div>
    <div class="container py-4">
        <Table DataSource="data" TItem="Data" HidePagination>
            <Column Title="งวดที่" DataIndex="ID" TData="int" />
            <Column Title="ประมวลผลทั้งหมด" DataIndex="allProcess" TData="int" Align="ColumnAlign.Center" />
            <Column Title="ผ่านการประมวลผล" DataIndex="passProcess" TData="int" Align="ColumnAlign.Center" />
            <Column Title="ไม่ผ่านการประมวลผล" DataIndex="nonPassProcess" TData="int" Align="ColumnAlign.Center" />
            <Column Title="AI พบความผิดปรกติ" DataIndex="abnormalAI" TData="int" Align="ColumnAlign.Center" />
        </Table>

    </div>

    <hr />


    <div class="d-flex justify-content-center pb-5">
        <Button Class="text-center" Type="@ButtonType.Primary" OnClick="@(() => {})">
            <i class="fa fa-sign-out pl-2" aria-hidden="true">ยืนยันการวินิจฉัย</i>
        </Button>
    </div>
    <div class="px-3">

        <div class="d-flex justify-content-around">
            <div>
                <div class="text-label">งวดที่</div>
                <Input Placeholder="ระบุงวด" @bind-Value="@Installment" />
            </div>
            <div>
                <div class="text-label">รหัสสถานพยาบาล</div>
                <Input Placeholder="ระบุงวด" @bind-Value="@HospitalCode" />
            </div>
            <div>
                <div class="text-label">เลขประจำตัวประชาชน</div>

                <div class="d-flex">
                    <Input Placeholder="ระบุงวด" @bind-Value="@IdCard" />
                    <Button Type="@ButtonType.Primary"><i class="fa fa-search" aria-hidden="true"></i></Button>
                </div>
            </div>
        </div>
    </div>


    <div class="mt-3" style="padding: 24px;">
        <div class="text-header">ตารางเเสดงรายการที่ผ่านการประมวลผล</div>
        <hr />
        <Table DataSource="@data2" HidePagination Bordered>

            <ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
                <ColumnDefinition />
            </ColumnDefinitions>

            <HeaderTemplate>
                <TableRow>
                    <SimpleTableHeader RowSpan="2">ลำดับ</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">งวด</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">เลขประจำตัวประชาชน</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">ชื่อ-นามสกุล</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">วันที่เข้ารักษา</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">วันที่สิ้นสุดการรักษา</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">ชื่อ รพ.</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">ค่า RW</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">เงินค่ารักษา</SimpleTableHeader>
                    <SimpleTableHeader RowSpan="2">เงินที่คำนวณได้</SimpleTableHeader>
                    <SimpleTableHeader>การวินิจฉัย</SimpleTableHeader>
                </TableRow>
                <TableRow>
                    <SimpleTableHeader>
                        <Checkbox Checked="@checkValue" CheckedChange="CheckClick">
                            มีสิทธิ์ทั้งหมด
                        </Checkbox>
                    </SimpleTableHeader>
                </TableRow>
            </HeaderTemplate>
            <RowTemplate>
                <TableRow>
                    <TableCell Align="ColumnAlign.Center">@context.Data.ID</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.Installment</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.IDCard</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.Name</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.DateOfTreatment</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.EndDateOfTreatMent</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.HospitalName</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.ValueRW</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.MoneyOfTreament</TableCell>
                    <TableCell Align="ColumnAlign.Center">@context.Data.MoneyCalculate</TableCell>
                    <TableCell Align="ColumnAlign.Center">
                        <Checkbox Checked="@checkValue" CheckedChange="CheckClick">
                        </Checkbox>
                    </TableCell>
                </TableRow>
            </RowTemplate>
        </Table>
        <Pagination Class="pt-3" ShowSizeChanger
                     OnShowSizeChange="OnShowSizeChange"
                     DefaultCurrent="3"
                     Total="500" />

         <hr />
     </div>

     <div class="px-3">
         <div class="d-flex justify-content-around">
             <div>
                 <div class="text-label">งวดที่</div>
                 <Input Placeholder="ระบุงวด" @bind-Value="@Installment" />
             </div>
             <div>
                 <div class="text-label">รหัสสถานพยาบาล</div>
                 <Input Placeholder="ระบุข้อมูล" @bind-Value="@HospitalCode" />
             </div>
             <div>
                 <div class="text-label">เลขประจำตัวประชาชน</div>

                 <div class="d-flex">
                     <Input Placeholder="ระบุข้อมูล" @bind-Value="@IdCard" />
                     <Button Type="@ButtonType.Primary"><i class="fa fa-search" aria-hidden="true"></i></Button>
                 </div>
             </div>
         </div>

         <div style="padding: 24px;">
             <div class="text-header">รายการเบิกที่ไม่ผ่านการประมวลผล</div>
             <hr />

             <Table DataSource="data3" TItem="Data3" HidePagination Bordered>
                <Column Title="ลำดับ" DataIndex="ID" TData="int" Align="ColumnAlign.Center" />
                <Column Title="งวด" DataIndex="Installment" TData="int" Align="ColumnAlign.Center" />
                <Column Title="เลขที่ประจำตัวประชาชน" DataIndex="IDCard" TData="int" Align="ColumnAlign.Center" />
                <Column Title="ชื่อนามสกุล" DataIndex="Name" TData="string" Align="ColumnAlign.Center" />
                <Column Title="วันที่เข้ารักษา" DataIndex="DateOfTreatment" TData="string" Align="ColumnAlign.Center" />
                <Column Title="วันที่สิ้นสุดการรักษา" DataIndex="EndDateOfTreatMent" TData="string" Align="ColumnAlign.Center" />
                <Column Title="ชื่อ รพ" DataIndex="HospitalName" TData="string" Align="ColumnAlign.Center" />
                <Column Title="ค่า RW" DataIndex="ValueRW" TData="int" Align="ColumnAlign.Center" SorterMultiple="3" SorterCompare="(a,b)=>a-b" />
                <Column Title="เงินค่ารักษา" DataIndex="MoneyOfTreament" TData="double" Align="ColumnAlign.Center" />
                <Column Title="เงินที่คำนวณได้" DataIndex="MoneyCalculate" TData="int" Align="ColumnAlign.Center" SorterMultiple="2" SorterCompare="(a,b)=>a-b" />
                <Column Title="การวินิจฉัย" DataIndex="Status" TData="string" Align="ColumnAlign.Center">
                    <Select TItem="DiagnosisStatus"
                            TItemValue="string"
                            DataSource="@_list"
                            @bind-Value="@_selectedValue1"
                            DefaultValue="@("lucy")"
                            ValueName="@nameof(DiagnosisStatus.Value)"
                            LabelName="@nameof(DiagnosisStatus.Name)"
                            Style="width:120px"
                            OnSelectedItemChanged="OnSelectedItemChangedHandler">
                    </Select>
                </Column>
                <Column Title="" DataIndex="Show" TData="string" Align="ColumnAlign.Center" Width="150px">

                    <img class="mx-2" src="helper_shared/PortalAdminImage/eye.png"
                         style="width:24px;height:24px; cursor:pointer;" @onclick=@(()=>{ OpenModalDetailData(true); }) />
                    <img class="mx-2" src="helper_shared/PortalAdminImage/alert.png"
                         style="width:24px;height:24px; cursor:pointer;" @onclick=@(()=>{ OpenModalAlertDiagnosisModal(true); }) />

                </Column>
            </Table>

            <Pagination Class="py-3" 
                        ShowSizeChanger
                        OnShowSizeChange="OnShowSizeChange"
                        DefaultCurrent="3"
                        Total="500" />
         </div>
     </div>
 </div>

 <ModalProcessingNotFinish _visible="openNotProcessNotFinish" OnClose="OpenModalAlertDiagnosisModal" />
 <ModalDetailData _visible="openDetailData" OnClose="OpenModalDetailData" />

 @inject IMessageService message;

 @code {

    string Installment { get; set; }
    string HospitalCode { get; set; }
    string IdCard { get; set; }

    bool openNotProcessNotFinish { get; set; }

    bool openDetailData { get; set; }

    [Parameter]
    public EventCallback<int> IndexPage { get; set; }


    public void OpenModalAlertDiagnosisModal(bool value)
    {
        openNotProcessNotFinish = value;
    }

    public void OpenModalDetailData(bool value)
    {
        openDetailData = value;
    }
    /* Data Models */

    public record Data(int ID, int allProcess, int passProcess, int nonPassProcess, int abnormalAI);

    public Data[] data =
    {
        new(6701,100,98,1,1)
    };

    public record Data2(
        int ID,
        int Installment,
        int IDCard,
        string Name,
        string DateOfTreatment,
        string EndDateOfTreatMent,
        string HospitalName,
        int ValueRW,
        double MoneyOfTreament,
        double MoneyCalculate,
        bool Status,
        string Show);

    public Data2[] data2 =
    {
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,true, "" ),
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,false, "" ),
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,true, "" ),
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,true, "" ),
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,false, "" ),
    };

    public record Data3(
        int ID,
        int Installment,
        int IDCard,
        string Name,
        string DateOfTreatment,
        string EndDateOfTreatMent,
        string HospitalName,
        int ValueRW,
        double MoneyOfTreament,
        double MoneyCalculate,
        string Status,
        string Show);

    public Data3[] data3 =
    {
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,"", "" ),
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,"", "" ),
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,"", "" ),
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,"", "" ),
        new(1,6701,12467890,"ดวงดี วิชัยวรศ์", "23 มิย 67","23 มิย 67","พญาไท",12,55000,45000,"", "" ),
    };

    private void OnShowSizeChange(PaginationEventArgs args)
    {
        var (current, pageSize) = args;
        Console.WriteLine($"{current}, {pageSize}");
    }


    /* Selection */

    string _selectedValue1;
    List<DiagnosisStatus> _list;
    List<string> _personNames;

    class DiagnosisStatus
    {
        public string Value { get; set; }
        public string Name { get; set; }
    }
    protected override void OnInitialized()
    {
        _list = new List<DiagnosisStatus>
        {
            new DiagnosisStatus {Value = "0", Name = "มีสิทธิ์"},
            new DiagnosisStatus {Value = "1", Name = "ไม่มีสิทธิ์"},
            new DiagnosisStatus {Value = "2", Name = "รอวินิจฉัย"},
            new DiagnosisStatus {Value = "3", Name = "ส่งกลับไปแก้ไข"}
        };
        _personNames = new List<string> { "Jack", "Lucy", "YaoMing" };
    }

    private void OnSelectedItemChangedHandler(DiagnosisStatus value)
    {
        Console.WriteLine($"selected: ${value?.Name}");
    }

    public async Task OnSearch()
    {
        await message.Loading($"searching {txtValue}", 2);
    }

    private string? txtValue { get; set; }
    private bool loading;

    /* CheckBox */

    private string checkTitle { get; set; } = "Check";
    private bool checkValue { get; set; } = false;

    private bool disableValue { get; set; } = false;

    void CheckClick()
    {
        if (checkValue)
        {
            checkValue = false;
        }
        else
        {
            checkValue = true;
        }
    }

    /* Change Page*/
    public async Task goEdit(int item)
    {
        await IndexPage.InvokeAsync(item);
    }


    /* Modal */

    public class Model
    {
        public string? installment { get; set; }

        public string? hospitalID { get; set; }

    }
    private Model model = new Model();


}