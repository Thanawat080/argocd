@using sso.mms.fees.admin.Data;
@using sso.mms.fees.admin.ViewModels.SlideBarLayout;
@using sso.mms.helper.Configs;

@inject MenuListService MenuListService

<Layout>
    <Sider Breakpoint="@BreakpointType.Xl"
           CollapsedWidth="0"
           Width="300" @bind-Collapsed=@collapsed
           Collapsible>

        <Menu Class="media-menu text-menu" Style="position: fixed;left: 10;"
              Theme="MenuTheme.Light"
              DefaultSelectedKeys=@(new[]{"1"})
              Mode="MenuMode.Inline"
              InlineCollapsed=collapsed>

            @foreach (var (menuItem, index) in MenuList.MenuItems!.Select((item, index) => (item, index)))
            {
                @if (MenuList.MenuItems![index]! != null)
                {
                    var key = index + 1;
                    @*  <MenuItem Key="@key.ToString()" RouterLink="@($"{MenuList.MenuItems[index].Link}?token={ShortToken}")">
                        <i class="@MenuList.MenuItems[index].Icon" style="font-size:20px;margin-right:5px;"></i>
                        <span>@MenuList.MenuItems[index].Title</span>
                    </MenuItem> *@
                    @if (menuItem.SubMenus != null)
                    {
                        RenderFragment sub1Title =
                        @<span>
                            <i class="@menuItem.Icon" style="font-size:20px;margin-right:5px;"></i>
                            <span style="color: #334396; font-size: 16px">@menuItem.Title</span>
                        </span>;
                        <SubMenu Key="@key.ToString()" TitleTemplate=@sub1Title>
                            @foreach (var submenu in menuItem.SubMenus)
                            {

                                if (ConfigureCore.ConfigENV == "Development")
                                {
                                    <MenuItem Key="@String.Format("sub{0:d}",  menuItem.SubMenus.IndexOf(submenu) + 1)" RouterLink="@($"{submenu.Link}?token={ShortToken}")">
                                        <span>@submenu.Title</span>
                                    </MenuItem>

                                }
                                else
                                {
                                    <MenuItem Key="@String.Format("sub{0:d}",  menuItem.SubMenus.IndexOf(submenu) + 1)" RouterLink="@($"/fees-admin{submenu.Link}?token={ShortToken}")">
                                        <span>@submenu.Title</span>
                                    </MenuItem>
                                }

                            }
                        </SubMenu>
                    }
                    else
                    {
                        if (ConfigureCore.ConfigENV == "Development")
                        {
                            <MenuItem Key="@key.ToString()" RouterLink="@($"{MenuList.MenuItems[index].Link}?token={ShortToken}")">
                                <i class="@MenuList.MenuItems[index].Icon" style="font-size:20px;margin-right:5px;"></i>
                                <span>@MenuList.MenuItems[index].Title</span>
                            </MenuItem>
                        }
                        else
                        {
                            <MenuItem Key="@key.ToString()" RouterLink="@($"/fees-admin{MenuList.MenuItems[index].Link}?token={ShortToken}")">
                                <i class="@MenuList.MenuItems[index].Icon" style="font-size:20px;margin-right:5px;"></i>
                                <span>@MenuList.MenuItems[index].Title</span>
                            </MenuItem>
                        }
                    
                    }
                }
            }
        </Menu>
    </Sider>

    <Layout Class="site-layout">
        <Content Style="margin:0 16px;">
            @ChildContent
        </Content>
    </Layout>
</Layout>


@code {

    [Parameter] public RenderFragment ChildContent { get; set; }
    [Parameter] public string ShortToken { get; set; }
    [Parameter] public string Page { get; set; }

    public MenuList MenuList { get; set; }

    bool collapsed;

    protected override void OnInitialized()
    {
        MenuList = MenuListService.GetMenuLists(Page);
    }


}
