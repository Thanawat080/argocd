@page "/disability/index"
@using System.IdentityModel.Tokens.Jwt;
@using Blazored.LocalStorage;
@using sso.mms.helper.PortalModel;
@using sso.mms.login.Services;
@using sso.mms.login.ViewModels;
@using sso.mms.portal.admin.Pages.Navbar


@inject NavigationManager NavigationManager
@inject ReadTokenService readTokenService
@inject UserRoleService userRoleService
@inject ILocalStorageService _localstorage;
@inject IconService iconService


<LayoutIndex ShortToken="@ShortToken" Page="disability">

    @if (usepageImportData == 1)
    {
        <Installment IndexPage="@((args)=>Indexpage(args.Item1, args.Item2))" />
    }
    else if (usepageImportData == 2)
    {
        <InstallmentList installmentData="@installmentData"/>
        
    }
    else if (usepageImportData == 3)
    {
        <InstallmentSubList />
    }
</LayoutIndex>



@code {
    [Parameter]
    [SupplyParameterFromQuery(Name = "token")]
    public string? ShortToken { get; set; } = "";



    public int usepageImportData = 1;
    public int installmentData { get; set; }

    public async Task Indexpage(int usepage, int item)
    {
        usepageImportData = usepage;
        installmentData = item;
    }

    public async Task Test(int index)
    {
        usepageImportData = index;
    }

    private ResponseShortToken responseShortToken { get; set; } = null!;

    public UserRole userRole;


    // protected override async Task OnInitializedAsync()
    // {
    //     responseShortToken = await readTokenService.ReadToken(ShortToken!);

    //     Console.WriteLine("responseShortToken", responseShortToken);

    //     if (responseShortToken != null)
    //     {
    //         JwtSecurityTokenHandler tokenHandler = new JwtSecurityTokenHandler();
    //         JwtSecurityToken jwt = tokenHandler.ReadJwtToken(responseShortToken.accessToken);
    //         var t = jwt.Payload.ToList();
    //         KeyValuePair<string, object> result = t.FirstOrDefault(pair => pair.Key == "preferred_username");
    //         var username = result.Value.ToString();

    //         userRole = await userRoleService.GetRoleByUserName(username);
    //         await _localstorage.SetItemAsync("userRole", userRole);

    //     }
    // }

}
