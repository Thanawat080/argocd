@using System.Text;
<style>
    @@media screen and (max-width: 900px) {
        .mms-media-end {
            display: flex;
            justify-content: start !important;
            align-items: start;
        }
    }

    .abx
    .ant-table-container
    .ant-table-content
    table
    thead.ant-table-thead
    .ant-table-cell {
        background: #F77C7C !important;
    }
</style>
<div class="site-layout-background" style="padding: 24px;">
    <div class="mms-nav-title">
        <div class="mms-text-title px-4 py-3">ส่งเสริมสุขภาพและป้องกันโรคกรณีวัคซีน</div>
    </div>
    <div class="container py-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item" aria-current="page">
                    <span class="breadcum-sucress py-2">รายการใช้สิทธิ์วัคซีนเชิงรุก</span>
                </li>
                <li class="breadcrumb-item" aria-current="page">
                    <span class="breadcum-sucress py-2">เพิ่มสถานประกอบการจองสิทธิ์</span>
                </li>
                <li class="breadcrumb-item" aria-current="page">
                    <span class="breadcum-process py-2">รายการผู้ใช้บริการ</span>
                </li>
            </ol>
        </nav>
        <div class="pt-4">
            <div class="row py-2">
                <div class="col-sm-12 col-md-6">
                    <div class="row">
                        <div class="col-6 mms-txt-headdetail site-end-colum">
                            <div>ชื่อสถานประกอบการ :</div>
                            <div>เลขที่บัญชีนายจ้าง :</div>
                            <div>สาขา :</div>
                        </div>
                        <div class="col-6 mms-text-gray mbsite-cloum">
                            <div>บริษัท ดีดีคัม จำกัด</div>
                            <div>1001234567890</div>
                            <div>-</div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 col-md-6">
                    <div class="row">
                        <div class="col-6 mms-txt-headdetail site-end-colum">
                            <div>วันที่จอง :</div>
                            <div>เบอร์โทรศัพท์ :</div>
                        </div>
                        <div class="col-6 mms-text-gray mbsite-cloum">
                            <div>1 ม.ค. 2567 </div>
                            <div>053-2345687</div>
                        </div>
                    </div>
                </div>
                <div class="row pt-3">
                    <div class="col-sm-12 col-md-3 mms-txt-headdetail">
                        <div class=" d-flex justify-content-end">ที่อยู่ :</div>
                    </div>
                    <div class="col-sm-12 col-md-9 mms-text-gray">
                        322 หมู่ 1 ต.ท่าสายลวด อ.แม่สอดรหัสไปรษณีย์ 63110
                    </div>
                </div>
            </div>
        </div>
        <hr />
        <div class="row py-2">
            <div class="col-sm-12 col-md-6">
                <div class="mms-txt-headdetail">
                    ตารางเเสดงรายพนักงานที่มีสิทธิ์รับการฉีดวัคซีนได้
                </div>
            </div>
            <div class="col-sm-12 col-md-6 mms-media-end">
                <Button Type="@ButtonType.Default" Style="width:200px"><i class="fa-solid fa-cloud-arrow-down"></i>&nbsp; ดาวน์โหลด</Button> &nbsp;
            </div>
        </div>
        <div class="row py-3">
            <div class="col-sm-12 col-md-6">
                <div class="mms-media-start">
                    <div class="mms-text-gray">จำนวนผู้มิสิทธิ์ทั้งหมด</div>
                    <div class="px-4">
                        <Input Placeholder="Basic usage" @bind-Value="@RightValue" Disabled ReadOnly />
                    </div>
                    <div class="mms-text-gray">คน</div>
                </div>
            </div>
            <div class="col-sm-12 col-md-2"></div>
            <div class="col-sm-12 col-md-4 d-flex">
                <Space Direction="@DirectionVHType.Vertical" Style="width:100%">
                    <SpaceItem>
                        <Search Placeholder="ข้อมูลที่ต้องการค้นหา.." EnterButton="true" />
                    </SpaceItem>
                </Space>
            </div>
        </div>
        <Table DataSource="listOfData" TItem="ItemData" RowClassName="@(_=>"editable-row")" @bind-PageSize="pageSize" Bordered  @bind-SelectedRows="selectedRows" ScrollX="1000">
            <ChildContent Context="data">
                <Column TData="string" Title="ลำดับ" Style="text-align:center;" Width="6%">
                    @String.Format("{0:d}", listOfData.IndexOf(data) + 1)
                </Column>
                <Column TData="string" Title="เลขประจำตัวประชาชน" Style="text-align:center;">
                    @data.fullName
                </Column>
                <Column TData="string" Title="ชื่อ-นามสกุล" Style="text-align:center;">
                    @data.identificationNumber
                </Column>
                <Column TData="string" Title="วัน/เดือน/ปีเกิด" Style="text-align:center;">
                    @data.surgeryDate
                </Column>
                <Column TData="string" Title="อายุ" Style="text-align:center;">
                    @data.idDonor
                </Column>
                <Column TData="string" Title="เบอร์โทร" Style="text-align:center;">
                    @data.idDonor
                </Column>
            </ChildContent>

            <PaginationTemplate>
                <Pagination 
                            Total="context.Total"
                            PageSize="context.PageSize"
                            Current="context.PageIndex"
                                        ShowSizeChanger
                            OnChange="context.HandlePageChange" />
            </PaginationTemplate>
            </Table>
            <hr />
            <div class="row py-2">
                <div class="col-sm-12 col-md-6">
                    <div class="mms-txt-headdetail">
                        ตารางเเสดงรายชื่อพนักงานที่ไม่มีสิทธิ์รับการฉีดวัคซีน
                    </div>
                </div>
                <div class="col-sm-12 col-md-6 mms-media-end">
                    <Button Type="@ButtonType.Default" Style="width:200px"><i class="fa-solid fa-cloud-arrow-down"></i>&nbsp; ดาวน์โหลด</Button> &nbsp;
                </div>
            </div>
            <div class="row py-3">
                <div class="col-sm-12 col-md-6">
                    <div class="mms-media-start">
                        <div class="mms-text-gray">จำนวนผู้มิสิทธิ์ทั้งหมด</div>
                        <div class="px-4">
                            <Input Placeholder="Basic usage" @bind-Value="@RightValue" Disabled ReadOnly />
                    </div>
                    <div class="mms-text-gray">คน</div>
                </div>
            </div>
            <div class="col-sm-12 col-md-2"></div>
            <div class="col-sm-12 col-md-4 d-flex">
                <Space Direction="@DirectionVHType.Vertical" Style="width:100%">
                    <SpaceItem>
                        <Search Placeholder="ข้อมูลที่ต้องการค้นหา.." EnterButton="true" />
                    </SpaceItem>
                </Space>
            </div>
        </div>
        <div class="2table">
            <Table Class="abx" DataSource="listOfData" TItem="ItemData"
                   @bind-PageSize="pageSize" Bordered TableLayout="fixed" @bind-SelectedRows="selectedRows" ScrollX="1000">
                <ChildContent Context="data">
                    <Column TData="string" Title="ลำดับ" Style="text-align:center;" Width="6%">
                        @String.Format("{0:d}", listOfData.IndexOf(data) + 1)
                    </Column>
                    <Column TData="string" Title="เลขประจำตัวประชาชน" Style="text-align:center;">
                        @data.fullName
                    </Column>
                    <Column TData="string" Title="ชื่อ-นามสกุล" Style="text-align:center;">
                        @data.identificationNumber
                    </Column>
                    <Column TData="string" Title="วัน/เดือน/ปีเกิด" Style="text-align:center;">
                        @data.surgeryDate
                    </Column>
                    <Column TData="string" Title="อายุ" Style="text-align:center;">
                        @data.idDonor
                    </Column>
                    <Column TData="string" Title="เบอร์โทร" Style="text-align:center;">
                        @data.idDonor
                    </Column>
                </ChildContent>

                <PaginationTemplate>
                    <Pagination 
                                Total="context.Total"
                                PageSize="context.PageSize"
                                Current="context.PageIndex"
                                                ShowSizeChanger
                                OnChange="context.HandlePageChange" />
                </PaginationTemplate>
                </Table>
            </div>
            <div class="py-4 mms-media-end">
                <Button Type="@ButtonType.Default" OnClick="@GoBack"><i class="fa-solid fa-circle-xmark"></i>&nbsp; ยกเลิก</Button> &nbsp;
                <Button Type="@ButtonType.Primary" OnClick="@GoNext"><i class="fa-solid fa-floppy-disk"></i>&nbsp; บันทึก</Button> &nbsp;
            </div>
        </div>
    </div>
    @using sso.mms.fees.ext.Shared.HealthPromoVaccinationExt.ProactiveVaccinationList.Modals
    <ModalViewDetail _visible=@callmodal OnClose="@Callmodal" />


    @code {

    /*-- CallbackModel --*/
    bool callmodal { get; set; }
    public int page;
    public void Callmodal(bool value)
    {
        callmodal = value;
    }

    List<ItemData> listOfData = new List<ItemData>();
    IEnumerable<ItemData> selectedRows;
    private int pageSize = 5;

    [Parameter]
    public EventCallback<int> IndexPage { get; set; }
    string txtValue { get; set; }
    string RightValue = "5";
    string phoder = "วว/ดด/ปป";
    public string FileName = "";
    public string ImageUri = "";
    public string imgpreview = "";

    List<UploadFileItem> fileList = new List<UploadFileItem>();
    public IBrowserFile bannerFile;

    private async void GoNext()
    {
        await IndexPage.InvokeAsync(1);
    }
    private async void GoBack()
    {
        await IndexPage.InvokeAsync(1);
    }

    public async Task goEdit(int item)
    {
        await IndexPage.InvokeAsync(item);

    }
    public async Task LoadImage(InputFileChangeEventArgs inputFileChangeEventArgs)
    {

        FileName = inputFileChangeEventArgs.File.Name;
        bannerFile = inputFileChangeEventArgs.File;
        // Handle CSV file
        if (inputFileChangeEventArgs.File.ContentType == "text/csv")
        {
            using Stream csvStream = inputFileChangeEventArgs.File.OpenReadStream();
            using StreamReader reader = new StreamReader(csvStream);
            string csvContent = await reader.ReadToEndAsync();
            var CsvContent = csvContent; // You can handle the CSV content as needed
            var CsvBase64 = Convert.ToBase64String(Encoding.UTF8.GetBytes(csvContent));
        }

        // Handle XLSX file
        if (inputFileChangeEventArgs.File.ContentType == "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")
        {
            using Stream xlsxStream = inputFileChangeEventArgs.File.OpenReadStream();
            using MemoryStream ms = new MemoryStream();
            await xlsxStream.CopyToAsync(ms);
            var XlsxBytes = ms.ToArray();
            var XlsxBase64 = Convert.ToBase64String(XlsxBytes);
        }

        StateHasChanged();
    }
    public class ItemData
    {
        public int Id { get; set; }
        public string identificationNumber { get; set; }
        public string fullName { get; set; }
        public string surgeryDate { get; set; }
        public string idDonor { get; set; }
        public string hospitalAccept { get; set; }
        public string serviceType { get; set; }
        public string createdDate { get; set; }
        public string amount { get; set; }
        public bool status { get; set; }

    };

    protected override void OnInitialized()
    {
        listOfData = Enumerable.Range(0, 19).Select(i => new ItemData
            {
                Id = i,
                identificationNumber = $"xxxxxxx{i}",
                fullName = $"Test Ter{i}",
                surgeryDate = "29 มี.ค. 2566",
                idDonor = "12345678",
                hospitalAccept = "โรงพยาบาล 1",
                serviceType = "กระจกตา",
                createdDate = "29 มี.ค. 2566",
                amount = "111111",
                status = false
            }).ToList();
        listOfData.Add(new ItemData
            {
                Id = 20,
                identificationNumber = $"xxxxxxx{20}",
                fullName = $"Test Ter{20}",
                surgeryDate = "299 มี.ค. 2566",
                idDonor = "999999999",
                hospitalAccept = "โรงพยาบาล 2",
                serviceType = "5555",
                createdDate = "29 มี.ค. 2566",
                amount = "111111",
                status = true
            });

    }


    private void OnBlur()
    {
        Console.WriteLine("blur");
    }

    private void OnFocus()
    {
        Console.WriteLine("focus");
    }

    private void OnSearch(string value)
    {
        Console.WriteLine($"search: {value}");
    }
}
