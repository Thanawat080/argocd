@using sso.mms.notification.ViewModel;
@using sso.mms.notification.Services;
@using sso.mms.helper.ViewModels;
@inject NotificationService notificationService;
<style>
    :root {
        --mdc-theme-primary: #334396;
    }

    .form-control, .form-select {
        display: block;
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: var(--bs-body-color);
        background-color: var(--bs-body-bg);
        background-clip: padding-box;
        border: var(--bs-border-width) solid #9e9e9e;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border-radius: var(--bs-border-radius-sm);
        transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
        height: 3rem;
    }

</style>
<div class="card-header-m txt-title-noti" align="center">
    <div class="txt-title-noti text-center py-4">
        หมวดหมู่
    </div>
</div>
<div class="col">
    @foreach (var item in responseNotiM.OrderBy(x => x.Sequence))
    {
        
            <div class="@item.DivClass row mb-2 " @onclick="@(() => ChangeColor(item))">
                <div class="noti-box col" style="color: #334396;">
                    <label>@item.Name</label>
                </div>
                <div class="col-1 noti-box" style="display:flex; align-items:center;">
                    @if (item.NotificationTs.Count > 0)
                    {
                        <a><span class="circleOrange">@item.NotificationTs.Count</span></a>
                    }
                    else
                    {
                        <div></div>
                    }
                </div>
            </div>

        
    }
    @*@foreach (var item in responseNotiM)
    {
        @if (item.Id != 8)
        {
            <div class="@item.DivClass row mb-2 " @onclick="@(() => ChangeColor(item))">
                <div class="noti-box col" style="color: #334396;">
                    <label>@item.Name</label>
                </div>
                <div class="col-1 noti-box" style="display:flex; align-items:center;">
                    @if (item.NotificationTs.Count > 0)
                    {
                        <a><span class="circleOrange">@item.NotificationTs.Count</span></a>
                    }
                    else
                    {
                        <div></div>
                    }
                </div>
            </div>

        }
    }*@
</div>
@code {
    [Parameter]
    public List<NotiM> responseNotiM { get; set; }


    [Parameter]
    public EventCallback<int> OnChangeListNotiT { get; set; }

    int count;

    //protected async Task OnAfterRender(bool FristRender)
    //{
    //    if(FristRender)
    //    {
    //        foreach (var clidkId in responseNotiM)
    //        {
    //            if (clidkId.Id == 1)
    //            {
    //             clidkId.DivClass = "clicked";
    //            }
    //        }
    //    }
    //}
    protected async Task OnAfterRender(bool FristRender)
    {

        if (FristRender)
        {
            foreach (var clidkId in responseNotiM)
            {
                if (clidkId.Id == 8)
                {
                    clidkId.DivClass = "clicked";
                }

            }
        }
    }

    private void ChangeColor(NotiM item)
    {
        item.DivClass = "";
        foreach (var i in responseNotiM)
        {
            if (i.Id == 1)
            {
                i.DivClass = "";
            }
            i.DivClass = "";
            foreach (var j in i.NotificationTs)
            {
                if (j.IsStatus == 1)
                {
                    count = j.NotificationLogs.Count + count;
                }
            }

        }

        item.DivClass = "clicked";

        if (item.DivClass == "clicked")
        {

            OnChangeListNotiT.InvokeAsync(item.Id);
        }

    }
}